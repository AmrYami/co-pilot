cases:
  - q: "list all contracts where CONTRACT_STATUS = expire"
    intent:
      direct_filter: {column: "CONTRACT_STATUS", op: "=", value: "expire"}
      sort_desc: true
    expect:
      contains: ['WHERE UPPER(CONTRACT_STATUS) = UPPER(:df_val)']

  - q: "top 10 contracts by contract value last month"
    intent:
      date_column: "OVERLAP"
      explicit_dates: {start: "2025-08-01", end: "2025-08-31"}
      sort_by: "NVL(CONTRACT_VALUE_NET_OF_VAT,0)"
      sort_desc: true
      top_n: 10
    expect:
      contains: ['WHERE (START_DATE IS NOT NULL AND END_DATE IS NOT NULL AND START_DATE <= :date_end AND END_DATE >= :date_start)',
                 'ORDER BY NVL(CONTRACT_VALUE_NET_OF_VAT,0) DESC',
                 'FETCH FIRST :top_n ROWS ONLY']

  - q: "top 10 contracts by contract value last 8 months"
    intent:
      date_column: "OVERLAP"
      explicit_dates: {start: "2025-02-01", end: "2025-09-30"}
      sort_by: "NVL(CONTRACT_VALUE_NET_OF_VAT,0)"
      sort_desc: true
      top_n: 10
    expect:
      contains: ['START_DATE <= :date_end', 'END_DATE >= :date_start', 'FETCH FIRST :top_n ROWS ONLY']

  - q: "contracts expiring in 30 days (count)"
    intent:
      agg: "count"
      date_column: "END_DATE"
      explicit_dates: {start: "2025-09-22", end: "2025-10-22"}
    expect:
      contains: ['SELECT COUNT(*) AS MEASURE', 'WHERE END_DATE BETWEEN :date_start AND :date_end']

  - q: "List all contracts requested last month (contract id, owner, request date)."
    intent:
      date_column: "REQUEST_DATE"
      explicit_dates: {start: "2025-08-01", end: "2025-08-31"}
      sort_by: "REQUEST_DATE"
      sort_desc: true
    expect:
      contains: ['WHERE REQUEST_DATE BETWEEN :date_start AND :date_end',
                 'ORDER BY REQUEST_DATE DESC']

  - q: "Top 20 contracts by gross contract value last month"
    intent:
      date_column: "OVERLAP"
      explicit_dates: {start: "2025-08-01", end: "2025-08-31"}
      sort_by: "NVL(CONTRACT_VALUE_NET_OF_VAT,0) + CASE WHEN NVL(VAT,0) BETWEEN 0 AND 1 THEN NVL(CONTRACT_VALUE_NET_OF_VAT,0) * NVL(VAT,0) ELSE NVL(VAT,0) END"
      sort_desc: true
      top_n: 20
    expect:
      contains: ['ORDER BY NVL(CONTRACT_VALUE_NET_OF_VAT,0)', 'FETCH FIRST :top_n ROWS ONLY']

  - q: "Total gross value of contracts per owner department last quarter"
    intent:
      date_column: "OVERLAP"
      explicit_dates: {start: "2025-04-01", end: "2025-06-30"}
      group_by: "OWNER_DEPARTMENT"
      agg: "sum"
      measure_sql: "NVL(CONTRACT_VALUE_NET_OF_VAT,0) + CASE WHEN NVL(VAT,0) BETWEEN 0 AND 1 THEN NVL(CONTRACT_VALUE_NET_OF_VAT,0) * NVL(VAT,0) ELSE NVL(VAT,0) END"
      sort_desc: true
    expect:
      contains: ['GROUP BY OWNER_DEPARTMENT', 'SUM(']

  - q: "Total gross value of contracts per owner department"
    intent:
      group_by: "OWNER_DEPARTMENT"
      agg: "sum"
      measure_sql: "NVL(CONTRACT_VALUE_NET_OF_VAT,0) + CASE WHEN NVL(VAT,0) BETWEEN 0 AND 1 THEN NVL(CONTRACT_VALUE_NET_OF_VAT,0) * NVL(VAT,0) ELSE NVL(VAT,0) END"
      sort_desc: true
    expect:
      contains: ['GROUP BY OWNER_DEPARTMENT', 'SUM(']

  - q: "Count of contracts by status (all time)"
    intent:
      group_by: "CONTRACT_STATUS"
      agg: "count"
      sort_desc: true
    expect:
      contains: ['SELECT CONTRACT_STATUS AS GROUP_KEY, COUNT(*) AS MEASURE', 'GROUP BY CONTRACT_STATUS']

  - q: "Contracts with END_DATE in the next 90 days."
    intent:
      date_column: "END_DATE"
      explicit_dates: {start: "2025-09-22", end: "2025-12-21"}
      sort_by: "REQUEST_DATE"
      sort_desc: true
    expect:
      contains: ['WHERE END_DATE BETWEEN :date_start AND :date_end']
