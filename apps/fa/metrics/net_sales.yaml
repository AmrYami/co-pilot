metric_key: fa.net_sales
metric_name: Net sales (invoices minus credit notes)
description: >
  Sum of line value (price * (1 - discount) * qty)
  signed negative for Customer Credit Notes (type 11).
calculation_sql: >
  SUM((CASE WHEN dt.type = 11 THEN -1 ELSE 1 END)
      * dtd.unit_price
      * (1 - COALESCE(dtd.discount_percent, 0))
      * dtd.quantity)
required_tables:
  - "debtor_trans as dt"
  - "debtor_trans_details as dtd"
required_columns:
  - "dt.type"
  - "dt.tran_date"
  - "dtd.unit_price"
  - "dtd.discount_percent"
  - "dtd.quantity"
parameters:
  date_column: "dt.tran_date"
  types_include: [10, 11]
category: sales
owner: apps.fa
version: 1
